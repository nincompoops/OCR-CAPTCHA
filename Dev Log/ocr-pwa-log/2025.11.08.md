# 2025.11.08 (토)

## 프로젝트 개요 및 목표

* **프로젝트명:** OCR Captcha PWA (ocr-captcha-pwa)
* **목표:** SvelteKit 기반의 PWA(Progressive Web App) 형태로, 클라이언트 측에서 이미지를 업로드하거나 캡처하여 Tesseract.js를 이용해 캡차(Captcha) 텍스트를 인식하는 솔버 애플리케이션 개발.
* **주요 기술 스택:** SvelteKit (TypeScript), Tesseract.js, VitePWA, Tailwind CSS.

---

## 초기 환경 설정 및 스택 구성

| 구성 요소 | 선택 | 비고 |
| :--- | :--- | :--- |
| **프레임워크** | SvelteKit | 높은 성능과 간결한 컴포넌트 구조를 위해 선택 |
| **언어/도구** | TypeScript, ESLint, Prettier | 코드 안정성, 품질, 일관된 스타일 유지를 위해 선택 |
| **스타일** | Tailwind CSS | Utility-first 방식으로 빠른 UI 개발 및 스타일링을 위해 설치 |
| **PWA** | vite-plugin-pwa | SvelteKit/Vite 환경에서 PWA 기능을 쉽게 통합하기 위해 설치 |
| **OCR 엔진** | tesseract.js | 클라이언트 측(브라우저)에서 OCR 처리를 수행하기 위해 설치 |

---

## 디버깅 과정 및 해결 (Troubleshooting Log)

프로젝트 초기 설정 과정에서 여러 차례의 모듈 시스템 충돌 및 설정 오류가 발생했으며, 이를 다음과 같이 해결함.

### 1. Svelte 프로젝트 생성 오류 해결

* **오류 내용:** `npm create svelte` 후 `npm install` 실행 시, `ENOENT: Could not read package.json` 오류 발생. (`npx sv create` 사용 권고 경고와 함께 발생)
* **해결:**
    1.  기존 폴더 삭제 (`rm -rf ocr-captcha-pwa`).
    2.  새로운 SvelteKit 프로젝트를 `npx sv create` 명령어를 사용하여 성공적으로 생성.
    3.  `minimal` 템플릿 선택 및 TypeScript, ESLint, Prettier 활성화.

### 2. Tailwind CSS 설치 과정 오류 해결

* **오류 내용:** `npx svelte-add tailwindcss` 실행 시, `Preconditions not met: clean working directory (Found modified files)` 경고 발생.
* **해결:**
    1.  Git을 사용하여 현재 변경 사항(초기 SvelteKit 설정 파일 등)을 커밋하여 작업 디렉토리를 깨끗하게 만듦.
    2.  `git add .` 후 `git commit -m "feat: Initial SvelteKit setup"` 실행.
    3.  `npx svelte-add tailwindcss`를 재실행하여 성공적으로 Tailwind CSS 설치 완료. (플러그인은 설치하지 않음)

### 3. Tailwind CSS 로드 실패 오류 해결 (Can't resolve 'tailwindcss')

* **오류 내용:** `npm run dev` 실행 시, `[plugin:@tailwindcss/vite:generate:serve] Can't resolve 'tailwindcss'` 오류 발생. 이는 PostCSS가 Tailwind를 찾지 못하는 문제였음.
* **해결 1: CSS 지시문 수정 (핵심)**:
    * `src/app.css` 파일의 잘못된 `@import 'tailwindcss/base';` 구문을 **표준 지시문**으로 변경.
    * **수정 내용:**
        ```css
        @tailwind base;
        @tailwind components;
        @tailwind utilities;
        ```
* **해결 2: `postcss.config.js` 확장자 변경**:
    * 오류 메시지 `module is not defined in ES module scope` 발생. `package.json`의 `"type": "module"` 설정 때문에 `.js` 파일이 ESM으로 해석되어 CJS 구문(예: `module.exports`)을 사용할 수 없었음.
    * **조치:** 파일 이름을 **`postcss.config.js`**에서 **`postcss.config.cjs`**로 변경하여 CJS 파일임을 명시.

### 4. ESLint와 CJS 구문 충돌 해결

* **오류 내용:** `tailwind.config.cjs` 파일 내 `require('@tailwindcss/typography')` 사용 시, ESLint가 `A 'require()' style import is forbidden. eslint(@typescript-eslint/no-require-imports)` 오류를 발생시킴.
* **해결:**
    1.  ESLint 설정 파일 **`eslint.config.js`**를 수정하여 `.cjs` 파일에 대한 예외 처리 규칙을 추가.
    2.  **`eslint.config.js`** 파일의 `export default defineConfig(...)`에 다음 설정 객체 추가:
        ```javascript
        {
            files: ['**/*.cjs'],
            rules: {
                '@typescript-eslint/no-require-imports': 'off', 
            }
        }
        ```

### 5. Tesseract.js 타입 오류 해결

* **오류 내용:** `src/routes/ocr/+page.svelte` 파일에서 `worker = await createWorker('eng', {});` 사용 시, TypeScript가 `Argument of type '{}' is not assignable to parameter of type 'OEM | undefined'.` 오류 발생.
* **해결:**
    1.  `createWorker`가 OEM(두 번째 인자)을 기대했기 때문에, 이를 `undefined`로 명시하고, 실제 옵션 객체를 세 번째 인자로 전달.
    2.  **수정 내용:**
        ```typescript
        worker = await createWorker('eng', undefined, { logger: () => {} });
        ```

### 6. 최종 개발 서버 상태 확인

* **최종 상태:** `VITE v7.2.2 ready in 855 ms`로 서버 정상 작동 확인.
* **로그:** `[404] GET /sw.js` 로그는 PWA의 서비스 워커 파일이 개발 환경에서는 빌드되지 않아 발생하는 정상적인 현상임을 확인.

---

## 🔜 다음 개발 계획

1.  **이미지 전처리 (OCR 정확도 개선):** `jimp` 라이브러리를 설치하고, 캡차 이미지에 대한 그레이스케일 및 이진화 등의 전처리 로직을 구현하여 `tesseract.js`에 전달한다.
2.  **UI/UX 개선:** Tailwind CSS를 활용하여 이미지 업로드 드래그-앤-드롭 영역 및 인식 결과 표시 영역의 디자인을 개선한다.
3.  **PWA 최적화:** `vite.config.js`에서 Tesseract.js의 언어 데이터 파일(`eng.traineddata.gz`) 및 코어 파일이 서비스 워커에 의해 캐싱되도록 Workbox 설정을 추가한다.